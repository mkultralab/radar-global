<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Global Ops Tactical V6.5 - Stencil Intel</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
        
        body, html { 
            margin: 0; padding: 0; height: 100%; width: 100%; 
            background-color: #020408; color: #e5e7eb; 
            overflow: hidden; font-family: 'JetBrains Mono', monospace; 
        }
        
        /* Layout fixo para Android */
        #map { position: absolute; top: 50px; height: 50%; width: 100%; z-index: 1; }
        .leaflet-layer { filter: invert(100%) hue-rotate(180deg) brightness(95%) contrast(90%); }
        .leaflet-control-container { display: none; }

        /* Painel de Texto com Rolagem Independente */
        #news-panel {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 50%;
            background: #080a0f; border-top: 4px solid #dc2626;
            z-index: 2000; display: flex; flex-direction: column;
            box-shadow: 0 -15px 40px rgba(0,0,0,1);
        }

        #news-header {
            padding: 12px 20px; background: #000; border-bottom: 1px solid #1f2937;
            display: flex; justify-content: space-between; align-items: center;
        }

        #news-body {
            flex: 1; overflow-y: auto; padding: 20px;
            font-size: 14px; line-height: 1.7; color: #d1d5db;
            -webkit-overflow-scrolling: touch;
        }

        /* Botões Táticos Estilo Stencil */
        .btn-tatico {
            width: 70px; height: 70px; border-radius: 12px;
            background: rgba(15, 23, 42, 0.95); border: 3px solid #dc2626;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.8);
            cursor: pointer; -webkit-tap-highlight-color: transparent;
            color: #ef4444;
        }
        .btn-tatico:active { transform: scale(0.9); background: #dc2626; color: white; }
        .btn-tatico svg { width: 35px; height: 35px; }

        .skull-marker { filter: drop-shadow(0 0 8px #ff0000); }
        
        /* Barra de rolagem customizada */
        #news-body::-webkit-scrollbar { width: 6px; }
        #news-body::-webkit-scrollbar-track { background: #000; }
        #news-body::-webkit-scrollbar-thumb { background: #dc2626; border-radius: 10px; }
    </style>
</head>
<body class="flex flex-col h-screen">

    <!-- Header Superior -->
    <header class="h-[50px] bg-black border-b border-gray-800 flex items-center justify-between px-4 z-20">
        <div class="flex items-center gap-3">
            <svg viewBox="0 0 24 24" class="w-6 h-6 text-red-600 fill-current"><path d="M12 2C9.5 2 7 4 7 7c0 3 2.5 5 2.5 5v3h5v-3s2.5-2 2.5-5c0-3-2.5-5-5-5zm-2 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm4 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1z"/></svg>
            <h1 class="font-black text-[12px] text-white tracking-widest uppercase italic">Ops <span class="text-red-600">Tactical</span> 6.5</h1>
        </div>
        <div id="utc-clock" class="text-[10px] text-gray-500 font-mono">00:00:00 UTC</div>
    </header>

    <div class="relative flex-1 flex flex-col">
        <!-- Mapa (Metade Superior) -->
        <div id="map"></div>

        <!-- Botões de Ação (Android Optimized) -->
        <div class="absolute top-[60px] right-4 flex flex-col gap-5 z-[1001]">
            <button onclick="getGPS()" class="btn-tatico" style="border-color: #3b82f6; color: #3b82f6;">
                <!-- Ícone de Mira/Alvo -->
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="22" y1="12" x2="18" y2="12"></line><line x1="6" y1="12" x2="2" y2="12"></line><line x1="12" y1="6" x2="12" y2="2"></line><line x1="12" y1="22" x2="12" y2="18"></line></svg>
            </button>
            <button onclick="runGlobalStrike()" class="btn-tatico">
                <!-- Ícone de Caveira Stencil -->
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C9.5 2 7 4 7 7c0 3 2.5 5 2.5 5v3h5v-3s2.5-2 2.5-5c0-3-2.5-5-5-5zm-2 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm4 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM10 18l-1 2h6l-1-2h-4z"/></svg>
            </button>
        </div>

        <!-- Painel de Inteligência (Metade Inferior) -->
        <div id="news-panel">
            <div id="news-header">
                <div class="flex items-center gap-2">
                    <div class="w-3 h-3 bg-red-600 rounded-full animate-ping"></div>
                    <span id="intel-title" class="text-white text-[12px] font-bold uppercase tracking-tighter">DATA EXTRACTION UNIT</span>
                </div>
                <div class="text-[8px] text-gray-600 font-bold italic">SECURITY LEVEL: ALPHA</div>
            </div>
            <div id="news-body" class="font-mono">
                <span class="text-red-500">> SISTEMA INICIALIZADO...</span><br>
                <span class="text-gray-500">> AGUARDANDO COORDENADAS DE ALVO NO MAPA...</span><br><br>
                Toque no mapa para extrair o histórico cronológico militar e avanços tecnológicos da área selecionada.
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        let map, tactical;
        const apiKey = ""; // Uplink Gemini

        // Caveira Custom Stencil para o Mapa
        const skullMarkerSVG = `
            <svg viewBox="0 0 24 24" class="w-10 h-10 text-red-600 fill-current skull-marker">
                <path d="M12 2C9.5 2 7 4 7 7c0 3 2.5 5 2.5 5v3h5v-3s2.5-2 2.5-5c0-3-2.5-5-5-5zm-2 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm4 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 18l-1 3h8l-1-3h-6z"/>
            </svg>
        `;

        const skullIcon = L.divIcon({
            html: skullMarkerSVG,
            className: '',
            iconSize: [40, 40],
            iconAnchor: [20, 40]
        });

        window.onload = () => {
            map = L.map('map', { zoomControl: false, attributionControl: false, center: [20, 0], zoom: 2 });
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            tactical = L.layerGroup().addTo(map);

            setInterval(() => { 
                document.getElementById('utc-clock').innerText = new Date().toISOString().split('T')[1].split('.')[0] + " UTC"; 
            }, 1000);

            map.on('click', (e) => {
                tactical.clearLayers();
                const { lat, lng } = e.latlng;
                L.marker([lat, lng], { icon: skullIcon }).addTo(tactical);
                fetchMilitaryIntel(lat, lng);
            });

            setTimeout(() => map.invalidateSize(), 600);
        };

        async function fetchMilitaryIntel(lat, lng) {
            const display = document.getElementById('news-body');
            display.innerHTML = "<p class='animate-pulse text-red-500'>> ACESSANDO WIKIPEDIA E ARQUIVOS MILITARES...<br>> EXTRAINDO CRONOLOGIA TÁTICA...</p>";

            try {
                const geoRes = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json`);
                const geoData = await geoRes.json();
                const country = geoData.address.country || "Território Não Mapeado";
                
                document.getElementById('intel-title').innerText = "DATA: " + country.toUpperCase();

                // Instrução para o Gemini focar em História, Wikipedia e Cronologia
                const userQuery = `Extraia dados históricos e tecnológicos militares de ${country}. Forneça uma cronologia curta dos conflitos mais importantes e avanços militares reais. Baseie-se em fatos da Wikipedia e arquivos históricos.`;

                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        contents: [{ parts: [{ text: userQuery }] }],
                        tools: [{ "google_search": {} }] // Ativa a busca por dados reais
                    })
                });

                const data = await res.json();
                const responseText = data.candidates?.[0]?.content?.parts?.[0]?.text || "Erro na extração de dados históricos.";

                display.innerHTML = `
                    <div class="space-y-4">
                        <div class="text-red-500 font-bold text-[11px] mb-2">> RELATÓRIO DE INTELIGÊNCIA CRONOLÓGICA</div>
                        <div class="border-l-4 border-red-600 pl-4 text-gray-300">
                            ${responseText.replace(/\n/g, '<br>')}
                        </div>
                        <div class="mt-6 pt-4 border-t border-gray-800 text-[10px] text-gray-600 italic">
                            DADOS EXTRAÍDOS VIA UPLINK SATELITAL | COORD: ${lat.toFixed(4)}, ${lng.toFixed(4)}
                        </div>
                    </div>
                `;
            } catch (e) {
                display.innerHTML = "<span class='text-red-600'>> ERRO CRÍTICO NO UPLINK. RECONECTE O TERMINAL.</span>";
            }
        }

        function getGPS() {
            navigator.geolocation.getCurrentPosition(p => {
                const { latitude, longitude } = p.coords;
                map.flyTo([latitude, longitude], 14);
                tactical.clearLayers();
                L.marker([latitude, longitude], { icon: skullIcon }).addTo(tactical);
                fetchMilitaryIntel(latitude, longitude);
            });
        }

        function runGlobalStrike() {
            tactical.clearLayers();
            const strikePoints = [[34.0, 44.0], [48.0, 37.0], [15.0, 43.0]];
            strikePoints.forEach(p => {
                L.circleMarker(p, { radius: 15, color: '#ff0000', weight: 2, fillOpacity: 0.3 }).addTo(tactical);
            });
            map.flyTo([30, 40], 3);
            document.getElementById('news-body').innerHTML = "<span class='text-red-600'>> MODO DE OPERAÇÕES GLOBAIS ATIVO.</span><br>> Selecione um alvo para histórico tático.";
        }
    </script>
</body>
</html>

