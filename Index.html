<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ops Tactical V5.4</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
        
        body, html { 
            margin: 0; padding: 0; height: 100%; width: 100%; 
            background-color: #020408; color: #e5e7eb; 
            overflow: hidden; font-family: 'JetBrains Mono', monospace; 
        }
        
        #map { position: absolute; top: 60px; bottom: 0; left: 0; right: 0; z-index: 1; }
        .leaflet-layer { filter: invert(100%) hue-rotate(180deg) brightness(95%) contrast(90%); }
        .leaflet-control-container { display: none; }

        /* Painel Intel - Ajuste de Resolução Android */
        #news-overlay {
            position: absolute; bottom: 0; left: 0; width: 100%;
            background: rgba(0, 0, 0, 0.98); 
            border-top: 2px solid #ef4444;
            transform: translateY(100%); transition: transform 0.3s ease-out;
            z-index: 2000; 
            padding: 15px 15px 30px 15px; 
            max-height: 50vh; 
            overflow-y: auto;
            box-sizing: border-box;
        }
        #news-overlay.active { transform: translateY(0); }

        .strike-icon { 
            width: 10px; height: 10px; background: #ff0000; border-radius: 50%;
            box-shadow: 0 0 10px #ff0000; animation: pulse 1s infinite;
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.5); } 100% { transform: scale(1); } }

        .btn-tatico {
            width: 52px; height: 52px; display: flex; align-items: center; justify-content: center;
            border-radius: 12px; background: rgba(15, 23, 42, 0.9); border: 1px solid rgba(255,255,255,0.1);
        }
    </style>
</head>
<body class="flex flex-col h-screen">

    <header class="h-[60px] bg-black border-b border-gray-800 flex items-center justify-between px-4 z-20">
        <div class="flex items-center gap-2">
            <i data-lucide="crosshair" class="text-red-600 w-5 h-5"></i>
            <h1 class="font-black text-[10px] text-white uppercase italic">Ops <span class="text-red-600">Tactical</span> V5.4</h1>
        </div>
        <div id="utc-clock" class="text-[10px] text-white font-bold">--:--:-- UTC</div>
    </header>

    <div class="relative flex-1">
        <div id="map"></div>

        <div id="news-overlay">
            <div class="flex justify-between items-center mb-4">
                <h3 id="news-country" class="text-white font-bold uppercase text-[12px]">INTEL</h3>
                <button onclick="closeNews()" class="text-red-600 text-[10px] font-bold">FECHAR</button>
            </div>
            <div id="news-body" class="text-[12px] text-gray-300 leading-relaxed space-y-3">
                <!-- Informação aparecerá aqui -->
            </div>
        </div>

        <div class="absolute bottom-8 right-4 flex flex-col gap-4 z-[1000]">
            <button onclick="runStrikes()" class="btn-tatico text-red-500">
                <i data-lucide="plane"></i>
            </button>
            <button onclick="getGPS()" class="btn-tatico text-blue-500">
                <i data-lucide="skull"></i>
            </button>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        lucide.createIcons();
        let map, tactical;
        const apiKey = ""; 

        window.onload = () => {
            map = L.map('map', { zoomControl: false, attributionControl: false, center: [20, 0], zoom: 2 });
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            tactical = L.layerGroup().addTo(map);

            setInterval(() => { 
                document.getElementById('utc-clock').innerText = new Date().toISOString().split('T')[1].split('.')[0] + " UTC"; 
            }, 1000);

            map.on('click', async (e) => {
                tactical.clearLayers();
                const { lat, lng } = e.latlng;
                L.circleMarker([lat, lng], { radius: 4, color: '#000', fillColor: '#000', fillOpacity: 1 }).addTo(tactical);
                updateIntel(lat, lng);
            });
            setTimeout(() => { map.invalidateSize(); }, 500);
        };

        async function updateIntel(lat, lng) {
            try {
                const res = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json`);
                const data = await res.json();
                const country = data.address.country || "Oceano";
                
                document.getElementById('news-country').innerText = country.toUpperCase();
                document.getElementById('news-overlay').classList.add('active');
                
                const prompt = `Cite 2 conflitos ou tensões militares em ${country} no último ano. Seja direto e curto.`;
                const gRes = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const gData = await gRes.json();
                const text = gData.candidates?.[0]?.content?.parts?.[0]?.text || "Vigilância passiva.";

                document.getElementById('news-body').innerHTML = `<p class="border-l-2 border-red-600 pl-2">${text}</p>`;
            } catch (e) {
                document.getElementById('news-body').innerText = "Erro no satélite.";
            }
        }

        function closeNews() { document.getElementById('news-overlay').classList.remove('active'); }

        function runStrikes() {
            tactical.clearLayers();
            [[31.5, 34.4], [48.3, 38.0], [15.5, 42.5]].forEach(p => {
                L.marker(p, { icon: L.divIcon({ className: 'strike-icon', iconSize: [10, 10] }) }).addTo(tactical);
            });
            map.flyTo([30, 40], 3);
        }

        function getGPS() {
            navigator.geolocation.getCurrentPosition(p => {
                const { latitude, longitude } = p.coords;
                map.flyTo([latitude, longitude], 15);
                L.marker([latitude, longitude], { icon: L.divIcon({ html: '<i data-lucide="skull" class="text-blue-500 w-8 h-8"></i>', className: '' }) }).addTo(tactical);
                setTimeout(() => lucide.createIcons(), 100);
            });
        }
    </script>
</body>
</html>

