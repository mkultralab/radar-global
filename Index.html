<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Global Ops Tactical V5.6</title>
    
    <!-- Bibliotecas Essenciais -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
        
        body, html { 
            margin: 0; padding: 0; height: 100%; width: 100%; 
            background-color: #020408; color: #e5e7eb; 
            overflow: hidden; font-family: 'JetBrains Mono', monospace; 
        }
        
        #map { position: absolute; top: 60px; bottom: 0; left: 0; right: 0; z-index: 1; }
        
        /* Filtro Noturno para o Mapa */
        .leaflet-layer { filter: invert(100%) hue-rotate(180deg) brightness(95%) contrast(90%); }
        .leaflet-control-container { display: none; }

        /* Painel de Intel Adaptável para Motorola */
        #news-overlay {
            position: absolute; bottom: 0; left: 0; width: 100%;
            background: rgba(5, 5, 10, 0.98); 
            border-top: 3px solid #dc2626;
            transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 2000; 
            padding: 20px 20px 40px 20px; 
            max-height: 50vh; 
            overflow-y: auto;
            box-sizing: border-box;
        }
        #news-overlay.active { transform: translateY(0); }

        .btn-tatico {
            width: 58px; height: 58px; display: flex; align-items: center; justify-content: center;
            border-radius: 14px; background: rgba(15, 23, 42, 0.95); border: 1px solid rgba(220, 38, 38, 0.4);
            color: #ef4444; box-shadow: 0 10px 20px rgba(0,0,0,0.6);
            -webkit-tap-highlight-color: transparent;
        }
        .btn-tatico:active { transform: scale(0.9); background: #dc2626; color: white; }
    </style>
</head>
<body class="flex flex-col h-screen">

    <!-- Header Fixo -->
    <header class="h-[60px] bg-black border-b border-gray-800 flex items-center justify-between px-4 z-20">
        <div class="flex items-center gap-2">
            <i data-lucide="crosshair" class="text-red-600 w-5 h-5"></i>
            <div>
                <h1 class="font-black text-xs text-white uppercase italic tracking-tighter">Tactical <span class="text-red-600">Ops</span></h1>
                <p class="text-[7px] text-gray-500 font-bold uppercase tracking-[0.2em]">V5.6-STABLE</p>
            </div>
        </div>
        <div class="text-right">
            <div id="utc-clock" class="text-[10px] text-white font-bold font-mono">00:00:00 UTC</div>
            <div class="text-[6px] text-green-500 font-bold animate-pulse">TERMINAL SEGURO</div>
        </div>
    </header>

    <div class="relative flex-1">
        <div id="map"></div>

        <!-- Notificações Laterais -->
        <div id="cmd-terminal" class="absolute top-4 left-4 bg-black/90 p-2 border-l-2 border-red-600 z-[1000] w-40 opacity-0 transition-opacity pointer-events-none">
            <h2 id="term-title" class="text-[8px] font-bold text-red-600 uppercase">STATUS</h2>
            <div id="term-content" class="text-[8px] text-gray-400 font-mono">A iniciar varrimento...</div>
        </div>

        <!-- Menu de Inteligência -->
        <div id="news-overlay">
            <div class="flex justify-between items-center mb-4">
                <div class="flex items-center gap-2">
                    <div class="w-2 h-2 bg-red-600 rounded-full animate-ping"></div>
                    <h3 id="news-country" class="text-white font-bold uppercase text-[11px] tracking-widest italic">Análise de Campo</h3>
                </div>
                <button onclick="closeNews()" class="text-gray-400 text-[10px] font-bold border border-gray-700 px-3 py-1 rounded">FECHAR</button>
            </div>
            <div id="news-body" class="text-[13px] text-gray-300 leading-relaxed space-y-4">
                Toque no mapa para extrair dados táticos do satélite.
            </div>
        </div>

        <!-- Botões de Ação Rápida -->
        <div class="absolute bottom-12 right-5 flex flex-col gap-4 z-[1000]">
            <button onclick="runGlobalStrike()" class="btn-tatico">
                <i data-lucide="plane"></i>
            </button>
            <button onclick="getGPS()" class="btn-tatico" style="color:#3b82f6; border-color:#3b82f666;">
                <i data-lucide="target"></i>
            </button>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        lucide.createIcons();
        let map, tactical;
        const apiKey = ""; // Gemini Uplink

        window.onload = () => {
            map = L.map('map', { zoomControl: false, attributionControl: false, center: [20, 0], zoom: 2 });
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            tactical = L.layerGroup().addTo(map);

            setInterval(() => { 
                const now = new Date();
                document.getElementById('utc-clock').innerText = now.getUTCHours().toString().padStart(2,'0') + ":" + 
                    now.getUTCMinutes().toString().padStart(2,'0') + ":" + 
                    now.getUTCSeconds().toString().padStart(2,'0') + " UTC"; 
            }, 1000);

            map.on('click', async (e) => {
                tactical.clearLayers();
                const { lat, lng } = e.latlng;
                L.circleMarker([lat, lng], { radius: 6, color: '#ff0000', weight: 2, fillOpacity: 0.1 }).addTo(tactical);
                logToTerminal("GEO-LOCK", lat.toFixed(3) + " / " + lng.toFixed(3));
                updateIntel(lat, lng);
            });

            setTimeout(() => { map.invalidateSize(); }, 500);
        };

        function logToTerminal(h, m) {
            const t = document.getElementById('cmd-terminal');
            document.getElementById('term-title').innerText = h;
            document.getElementById('term-content').innerText = "> " + m;
            t.style.opacity = "1";
            setTimeout(() => t.style.opacity = "0", 3000);
        }

        async function updateIntel(lat, lng) {
            document.getElementById('news-overlay').classList.add('active');
            document.getElementById('news-body').innerHTML = "<p class='animate-pulse text-red-500'>A contactar rede de satélites...</p>";

            try {
                const res = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json`);
                const data = await res.json();
                const country = data.address.country || "Águas Neutras";
                
                document.getElementById('news-country').innerText = "PAÍS: " + country.toUpperCase();
                
                const prompt = `Gere um relatório militar curto e direto (3 pontos) sobre a situação de segurança ou conflitos em ${country} no ano de 2025.`;
                const gRes = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const gData = await gRes.json();
                const text = gData.candidates?.[0]?.content?.parts?.[0]?.text || "Sem atividade hostil reportada.";

                document.getElementById('news-body').innerHTML = `
                    <div class="border-l-2 border-red-600 pl-3">
                        ${text.replace(/\n/g, '<br>')}
                    </div>
                    <div class="pt-4 mt-4 border-t border-gray-900 text-[9px] text-gray-600">
                        ESTADO DO CANAL: ENCRIPTADO | SCAN TÁTICO COMPLETO
                    </div>
                `;
            } catch (e) {
                document.getElementById('news-body').innerText = "Erro no uplink de dados.";
            }
        }

        function closeNews() { document.getElementById('news-overlay').classList.remove('active'); }

        function runGlobalStrike() {
            tactical.clearLayers();
            const targets = [[31.5, 34.4], [48.3, 38.0], [15.5, 42.5]];
            targets.forEach(p => {
                L.circleMarker(p, { radius: 10, color: '#ef4444', weight: 1, fillOpacity: 0.4 }).addTo(tactical);
            });
            logToTerminal("AIR OPS", "Alvos estratégicos mapeados.");
            map.flyTo([30, 40], 3);
        }

        function getGPS() {
            navigator.geolocation.getCurrentPosition(p => {
                const { latitude, longitude } = p.coords;
                map.flyTo([latitude, longitude], 15);
                L.marker([latitude, longitude], { icon: L.divIcon({ html: '<i data-lucide="skull" class="text-blue-500 w-10 h-10"></i>', className: '' }) }).addTo(tactical);
                lucide.createIcons();
            }, () => logToTerminal("ERRO", "Ative o GPS do Motorola."));
        }
    </script>
</body>
</html>

